# 两阶段名字查找

两阶段名字查找在第一章也有提过，这里主要是补充细节

为什么要设立两阶段查找？

特意分为两阶段是为了在第一阶段：模板定义阶段就把尽可能多的error给排除，有助于编译器的排错

两阶段指的是模板定义阶段和模板实例化阶段

## 定义阶段

第一阶段是解析模板，非依赖性名字执行OL，可根据条件继续执行ADL，但不进入第二阶段

非限定性依赖性名字也执行OL，但是查找并未结束

## 实例化阶段

第二阶段，在实例化点（points of instantiation）上进行实例化。

对限定性依赖性名字以及第一阶段执行过OL的非限定性依赖性名字执行ADL

## trap：决定一个名字是否为模板

考虑以下代码：

```cpp
namespace N{
    template<typename T>
    void g(T){}
    enum E{e};
}
template<typename T>
void f(T){}
    
template<typename T> 
void h(T p){
    g<int>(p);	//ERROR!
    f<int>(p);		
}
    
int main(){
    h(N::e);
}
```

OL是不完整的，也正因此可以用来决定一个名字是否为模板，找不到模板的话，<会被识别为小于运算符。

g< int>(p)因为第一阶段没有找到名字，尽管可以通过第二阶段的ADL找到对应得模板，但是在被识别为小于运算符的那个瞬间已经产生error

